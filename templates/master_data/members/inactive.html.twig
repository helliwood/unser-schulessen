{% extends 'base.html.twig' %}

{% block body %}
    <div class="example-wrapper">
        <h1><span class="printOnly">{{ school.name }} | </span>Unsere Schule<span
                    class="printOnly"> vom {{ "now"|date("d.m.Y") }}</span></h1>
        <div class="row">
            <div class="col-xl-12">
                <div class="panel">
                    <div class="d-flex mb-2">
                        <h3><i class="fas fa-user-friends text-primary2 mr-1"></i>Inaktive Mitglieder</h3>
                        <div class="ml-auto no-print">
                            <button class="btn btn-primary flex-end" onclick="window.print();">
                                <i class="fas fa-print mr-1"></i>Drucken
                            </button>
                        </div>
                    </div>
                    <div class="mb-2">Verzeichnis der inaktiven oder abgelehnten Personen, beschrieben mit ihrer
                        Funktion (Rolle) und Rechten.
                    </div>

                    <data-table
                            api-url="{{ path('master_data_members_list_inactive') }}"
                            sort-by="state"
                            :sort-desc="false"
                            :per-page="10"
                            :fields="[
                                {key: 'name', label: 'Name', sortable: true},
                                {key: 'personType', label: 'Typ', sortable: true},
                                {key: 'state', label: 'Status', sortable: true},
                                {key: 'options', label: 'Optionen', sortable: false, class:'options'}
                            ]">
                        <template v-slot:cell(personType)="row">
                            {{ '{{' }}row.item.personType{{ '}}' }}<br/>
                            <span class="text-muted small">Rolle: {{ '{{' }}row.item.roleText{{ '}}' }}</span>
                        </template>
                        <template v-slot:cell(state)="row">
                            {{ '{{' }}row.item.stateText{{ '}}' }}
                        </template>
                        <template v-slot:cell(name)="row">
                            {{ '{{' }}row.item.user.displayName{{ '}}' }}
                            <b-badge v-if="row.item.user.id=='{{ app.user.id }}'" variant="warning" class="no-print">ich
                            </b-badge>
                            <div v-if="row.item.user.displayName != row.item.user.email" class="text-muted">
                                {{ '{{' }}row.item.user.email{{ '}}' }}
                            </div>
                        </template>
                        <template v-slot:cell(options)="{row, callAndRefresh}">
                            {% if is_granted('ROLE_FOOD_COMMISSIONER') %}
                                <b-button size="sm" :href="'/master_data/members/edit/'+row.item.user.id"
                                          class="mr-2 no-print">
                                    <i class="fas fa-edit mr-1"></i>Bearbeiten
                                </b-button>

                                <span v-if="row.item.role != 'ROLE_HEADMASTER' && row.item.state != {{ constant('App\\Entity\\User::STATE_NOT_ACTIVATED') }}">
                                <b-button
                                        v-if="row.item.state === {{ constant('App\\Entity\\UserHasSchool::STATE_BLOCKED') }}"
                                        v-b-modal="'modalUnblock-'+row.item.user.id" class="no-print"
                                        size="sm" variant="primary"><i class="fas fa-check mr-1"></i>Entsperren
                                </b-button>
                                    <!-- Modal Component -->
                                <b-modal :id="'modalUnblock-'+row.item.user.id"
                                         @ok="callAndRefresh({action:'block_user', user_id:row.item.user.id}, '{{ path('master_data_members_list') }}')"
                                         title="Entsperren" size="sm" ok-variant="primary"
                                         ok-title="Entsperren"
                                         cancel-title="Abbrechen">
                                    <p class="my-4">Möchten Sie '{{ '{{' }}
                                        row.item.user.displayName{{ '}}' }}' wirklich Entsperren?
                                    </p>
                                </b-modal>
                                <b-button
                                        v-if="row.item.state == {{ constant('App\\Entity\\UserHasSchool::STATE_ACCEPTED') }}"
                                        v-b-modal="'modalBlock-'+row.item.user.id"
                                        size="sm" variant="secondary" class="no-print">
                                    <i class="fas fa-times mr-1"></i>Sperren
                                </b-button>
                                    <!-- Modal Component -->
                                <b-modal :id="'modalBlock-'+row.item.user.id"
                                         @ok="callAndRefresh({action:'block_user', user_id:row.item.user.id}, '{{ path('master_data_members_list') }}')"
                                         title="Sperren" ok-variant="danger"
                                         ok-title="Sperren"
                                         cancel-title="Abbrechen">
                                <p class="my-4">Möchten Sie '{{ '{{' }}
                                    row.item.user.displayName{{ '}}' }}' wirklich Sperren?
                                </p>
                            </b-modal>
                        </span>

                                <b-button v-if="row.item.state == 0" v-b-modal="'modal-'+row.item.user.id" size="sm"
                                          variant="danger" class="no-print"><i class="far fa-trash-alt"></i>
                                </b-button>
                                <!-- Modal Component -->
                                <b-modal :id="'modal-'+row.item.user.id"
                                         @ok="callAndRefresh({action:'delete_invitation', user_id:row.item.user.id}, '{{ path('master_data_members_list') }}')"
                                         title="Einladung löschen" ok-variant="danger" ok-title="Löschen"
                                         cancel-title="Abbrechen">
                                    <p class="my-4">Möchten Sie die Einladung an '{{ '{{' }}
                                        row.item.user.displayName{{ '}}' }}' wirklich löschen?</p>
                                </b-modal>
                            {% endif %}
                        </template>
                    </data-table>
                    <div class="form-group row">
                        <div class="col-sm-3"></div>
                        <div class="col-sm-9 d-flex">
                            <div class="ml-auto">
                                <div class="mt-auto pl-2 mt-1 d-flex no-print">
                                    <a href="{{ path('master_data_home') }}" class="btn btn-warning mt-1 no-print">Zurück</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}