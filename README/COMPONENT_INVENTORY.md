# Component Inventory

This document lists all major system components of **Unser Schulessen** across frontend, backend, database, proxy/routing, storage, CI/CD, and operations.

Owner fields are role-based operational owners inferred from the repository structure and pipeline setup. Replace role labels with concrete team names if needed.

## Component Directory

| Component | Category | Purpose | Main Interfaces | Key Dependencies | Environments | Federal-State Instances | Owner | Operational Responsibility |
|---|---|---|---|---|---|---|---|---|
| State Domain Routing (`<state>.unser-schulessen.de`) | Proxy/Routing | Route incoming traffic to state-specific runtime instances. | HTTPS hostnames per state subdomain. | External DNS/TLS setup, container host port mappings. | Stage, Prod | Stage: `rp` (bb-stage URL currently configured). Prod: `bb, be, bw, by, hb, he, hh, mv, ni, nw, rp, sh, sl, sn, st, th`. | Platform/Infra Team | Domain mapping, TLS certificate lifecycle, routing correctness per state. |
| Host-Level Reverse Proxy / Port Exposure | Proxy/Routing | Expose containerized Apache services to network clients. | Host ports (`8080`, `6000-6014`, etc.) to container `:80`. | Docker runtime on deployment host. | Dev, Stage, Prod | One runtime endpoint per deployed state container. | Platform/Infra Team | Port mapping, network/firewall controls, runtime availability. |
| Symfony Web Application Container (`web`) | Backend Runtime | Execute HTTP requests, business logic, templates, API/form handling. | HTTP, Symfony routes/controllers, environment variables. | Apache, PHP, Symfony 5.4, Composer dependencies. | Dev, Test, Stage, Prod | One app container per state in deployed environments. | Application Team | Release readiness, runtime behavior, secure configuration, incident handling. |
| Twig UI Layer | Frontend (SSR) | Render server-side HTML views for authenticated and public flows. | Twig templates under `/templates`, rendered over HTTP responses. | Symfony controller/view pipeline, translations, assets. | Dev, Test, Stage, Prod | State-specific behavior via `APP_STATE_COUNTRY`. | Application Team | Template correctness, UX integrity, compatibility with state variants. |
| Vue.js Frontend Components | Frontend (Client) | Provide interactive UI widgets/forms/charts in browser. | Browser JS bundle from Webpack Encore. | Vue 2.6, Bootstrap-Vue, ApexCharts, Encore build output. | Dev, Test, Stage, Prod | Shared code; behavior varies by backend data/state flags. | Application Team | Client-side reliability, bundle compatibility, regression prevention. |
| Authentication & Authorization | Backend Security | User login, session handling, role-based access control. | `/login`, `/logout`, secured route access control, invitation/reset flows. | Symfony Security config, `User`/`UserHasSchool` entities, firewall rules. | Dev, Test, Stage, Prod | Same model across states; data isolated per state DB. | Application Team | Access policy maintenance, credential flow integrity, security response. |
| Quality Check Module | Backend Domain | Manage questionnaires, answers, scoring/evaluation, result lifecycle. | Controllers/services/entities/forms for quality checks. | Doctrine ORM, state-aware questionnaire logic, PDF/email integrations. | Dev, Test, Stage, Prod | Per-state data and state-specific question configuration. | Product + Application Team | Functional correctness, domain rule changes, data consistency. |
| Master Data Module | Backend Domain | Capture and maintain school master data per school year and state. | Master data controllers/forms/services. | `MasterDataService`, state-specific question sets, Doctrine. | Dev, Test, Stage, Prod | Per-state dynamic configuration using `APP_STATE_COUNTRY`. | Product + Application Team | Data model stewardship, validation rules, backward compatibility. |
| Survey Module | Backend Domain | Create/manage surveys and public survey participation. | Survey controllers, public routes, survey entities/repositories. | Doctrine ORM, security roles, Twig/Vue UI. | Dev, Test, Stage, Prod | Per-state deployment and DB isolation. | Product + Application Team | Survey lifecycle governance, correctness of publish/close flows. |
| Food Survey Module | Backend Domain | Additional school meal survey workflows and result views. | Food survey controllers/public views/forms. | Doctrine ORM, Twig/Vue components, state runtime context. | Dev, Test, Stage, Prod | Per-state deployment and DB isolation. | Product + Application Team | Functional operation, result integrity, release validation. |
| Mini-Check Public Module | Backend/Public | Public quick-check workflow without full authenticated session. | Public Mini-Check routes and session-based result handling. | `MiniCheckService`, active questionnaire, Doctrine. | Dev, Test, Stage, Prod | State-specific questionnaire selection at runtime. | Product + Application Team | Public path availability, abuse prevention, data validity. |
| PDF Generation (DomPDF) | Backend Integration | Generate printable reports for quality checks and related outputs. | PDF templates under `/templates/pdf`, download/response endpoints. | DomPDF, Twig templates, module data sources. | Dev, Test, Stage, Prod | Shared implementation, state-specific content/data. | Application Team | Template maintainability, output quality, rendering stability. |
| Email Delivery (`MAILER_DSN`) | External Integration | Send transactional notifications and workflow emails. | Symfony Mailer transport DSN, SMTP/API provider interface. | `config/packages/mailer.yaml`, Sendinblue-compatible DSN. | Dev, Stage, Prod (`test` uses `null://null`) | State-specific sender context where configured. | Application Team + Platform Team | Mail transport config, delivery troubleshooting, provider credential rotation. |
| Translation & State Overlay Loader | Backend i18n | Load default + state-specific translation files per runtime state. | Translation file loading in `Kernel::process`. | `APP_STATE_COUNTRY`, `/translations/default`, `/translations/<state>`. | Dev, Test, Stage, Prod | One overlay directory per state (where available). | Application Team | Translation lifecycle, state text correctness, fallback behavior. |
| MariaDB Primary Database (per state) | Database | Persist application data for each state tenant instance. | MySQL/MariaDB protocol via `DATABASE_URL`. | MariaDB 10.3, Doctrine mappings/migrations. | Dev, Stage, Prod | Dedicated database/schema per state (`unser_schulessen_<state>` pattern in pipeline). | DBA/Platform Team | Availability, backup/restore, schema migration execution, performance. |
| MariaDB Test Database (`testdb`) | Database | Isolated database for automated tests and schema validation. | `TEST_DATABASE_URL`, Docker `testdb` service. | Doctrine migrations/fixtures, PHPUnit pipeline. | Dev, Test (CI) | Not state-separated for local test setup by default. | Application Team + CI Owners | Test data resets, migration parity checks, CI reliability. |
| File Storage (`/var/www/var/data`) | Storage | Persist uploaded/generated artifacts (documents, media, exports). | Local filesystem mount paths in container. | Docker volume mounts (`/datastore/<state>/` in deploy jobs). | Stage, Prod (Dev uses project-local volumes) | Dedicated storage mount per state deployment job. | Platform/Infra Team | Capacity management, backups, restore procedures, permissions. |
| Static Public Assets/Documents (`/public`, `/assets`) | Storage/Delivery | Serve static media, logos, PDFs, and compiled frontend bundles. | HTTP static file serving via Apache. | Webpack Encore output, repository-managed assets. | Dev, Test, Stage, Prod | Shared codebase; state-specific document folders where applicable. | Application Team | Asset lifecycle, correctness of state documents, cache/version alignment. |
| Docker Build Artifacts (`Dockerfile`, `Dockerfile_deploy`, `Dockerfile_test`) | Build/Runtime | Define reproducible runtime images for dev, deploy, and tests. | Docker build CLI and image tags. | Base images, PHP extensions, Apache configuration, app source. | Dev, Test, Stage, Prod | Same image baseline reused for all state deployments. | Platform/DevOps Team | Image hardening, dependency updates, build reproducibility. |
| GitLab CI Pipeline (`.gitlab-ci.yml`) | CI/CD | Build, test, and deploy release candidates and production instances. | GitLab runners, job stages (`build`, `test`, `deploy`). | Docker daemon on runner, DB credentials, environment variables. | Test, Stage, Prod | Separate deploy jobs for each production state + stage job. | DevOps/Release Team | Pipeline health, deployment orchestration, rollback coordination. |
| Automated DB Backup Step (`mysqldump` in deploy jobs) | Operations/Backup | Create per-state pre-migration database backups during deployment. | `mysqldump` output files on runner host. | DB credentials, runner storage, deploy job scripts. | Prod | Backup file per deployed state during its job execution. | DBA/DevOps Team | Backup execution verification, retention, recovery testing. |
| Application Logging (Monolog) | Monitoring/Logging | Capture app/runtime logs for debugging and incident analysis. | Log files under `%kernel.logs_dir%/<env>.log`. | Symfony Monolog handlers per env config. | Dev, Test, Prod | Log stream produced by each state runtime instance. | Application Team + Ops Team | Log policy, rotation/retention setup, incident triage support. |
| Health & Runtime Monitoring (Documented Operating Practice) | Monitoring | Validate app, DB, cache, and storage health as operational checks. | Documented health endpoints and container/runtime checks. | Operational scripts/processes, deployment host observability. | Stage, Prod | Expected for all state instances. | Operations Team | Monitoring execution, alerting integration, uptime verification. |

## Notes and Scope Clarifications

- The repository shows explicit deployment jobs for 16 production federal-state instances and one stage instance.
- Health endpoints are documented in technical documentation; confirm implementation details in runtime environment before relying on them for automated monitoring.
- Owner labels are role-based placeholders and should be mapped to named teams/persons in your organization.
